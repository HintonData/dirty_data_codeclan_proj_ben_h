---
title: "Task 4 Analysis"
output: html_notebook
---

```{r}
library(tidyverse)
library(here)
candy_cleaned <- read_csv(here("clean_data/boing_boing_cleaned.csv"))
```


1. What is the total number of candy ratings given across the three years. (Number of candy ratings, not the number of raters. Donâ€™t count missing values)

```{r}
# First we select all the columns with ratings; this is what we want to count.
candy_cleaned_ratings_only <- candy_cleaned %>% 
  select(ratings)

# Then we sum all the Not NA values, giving us the total number of candy ratings!
sum(!is.na(candy_cleaned_ratings_only))

```

2. What was the average age of people who are going out trick or treating?

```{r}
# We filter so we only get those who went out trick or treating, then took the mean of the age column; removing NAs so we could perform this calculation!

candy_cleaned %>% 
  filter(trick_or_treating == "Yes") %>% 
  filter(age < 120) %>% 
  summarise(avg_age_of_trick_or_treaters = mean(age, na.rm = TRUE))
```





3. What was the average age of people who are not going trick or treating?

```{r}
candy_cleaned %>% 
  filter(trick_or_treating == "No") %>% 
  filter(age < 120) %>% 
  summarise(avg_age_of_not_trick_or_treaters = mean(age, na.rm = TRUE))
```



4. For each of joy, despair and meh, which candy bar received the most of these ratings?



```{r}
# First we work out "JOY"
candy_cleaned %>%
  filter(ratings == "JOY") %>% 
  group_by(candy) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% 
  head(1) %>% 
  select(candy) %>% 
  pull()

# Now "MEH"
candy_cleaned %>%
  filter(ratings == "MEH") %>% 
  group_by(candy) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% 
  head(1) %>% 
  select(candy) %>% 
  pull()


# Now "DESPAIR"
candy_cleaned %>%
  filter(ratings == "DESPAIR") %>% 
  group_by(candy) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% 
  head(1) %>% 
  select(candy) %>% 
  pull()
  
```


5. How many people rated Starburst as despair?

```{r}
candy_cleaned %>% 
  filter(candy == "starburst" & ratings == "DESPAIR") %>% 
  nrow()
```

For the next three questions, count despair as -1, joy as +1, and meh as 0.

```{r}
candy_cleaned <- candy_cleaned %>% 
  mutate(ratings_numeric = case_when(
    ratings == "DESPAIR" ~ as.numeric(-1),
    ratings == "MEH" ~ as.numeric(0),
    ratings == "JOY" ~ as.numeric(1),
    TRUE ~ NA_real_))
```



6. What was the most popular candy bar by this rating system for each gender in the dataset?

```{r}
scores <- candy_cleaned %>% 
  group_by(gender, candy) %>% 
  summarise(score_of_candy = sum(ratings_numeric, na.rm = TRUE))

scores_female <- scores %>% 
  filter(gender == "Female") %>% 
  mutate(high_score = max(score_of_candy)) %>% 
  filter(score_of_candy == high_score)

scores_male <- scores %>% 
  filter(gender == "Male") %>% 
  mutate(high_score = max(score_of_candy)) %>% 
  filter(score_of_candy == high_score) %>% 
  select(candy) %>% 
  pull()

scores_other <- scores %>% 
  filter(gender == "Other") %>% 
  mutate(high_score = max(score_of_candy)) %>% 
  filter(score_of_candy == high_score) %>% 
  select(candy) %>% 
  pull()

scores_rather_not_say <- scores %>% 
  filter(gender == "I'd rather not say") %>% 
  mutate(high_score = max(score_of_candy)) %>% 
  filter(score_of_candy == high_score) %>% 
  select(candy) %>% 
  pull()

scores_male
scores_female
scores_other
scores_rather_not_say
```


7. What was the most popular candy bar in each year?

```{r}
# There was no timestamp variable for 2017, so we filter where NAs are TRUE for timestamp.

score_for_2017 <- candy_cleaned %>%
  filter(is.na(timestamp) == TRUE) %>% 
  group_by(candy) %>% 
  summarise(ratings_sum = sum(ratings_numeric, na.rm = TRUE)) %>%
  mutate(max_rating = max(ratings_sum)) %>%
  filter(ratings_sum == max_rating) %>% 
  select(candy) %>% 
  pull()



# For this next part, we need to convert the format of timestamp so we can get the range we want. Then we filter for timestamp == 2016 then timestamp == 2015.


score_for_2016 <- candy_cleaned %>%
  filter(timestamp >= '2016-01-01 00:00:00' & timestamp <= '2016-12-31 23:59:59') %>% 
  group_by(candy) %>% 
  summarise(ratings_sum = sum(ratings_numeric, na.rm = TRUE)) %>%
  mutate(max_rating = max(ratings_sum)) %>%
  filter(ratings_sum == max_rating) %>% 
  select(candy) %>% 
  pull()


score_for_2015 <- candy_cleaned %>%
  filter(timestamp >= '2015-01-01 00:00:00' & timestamp <= '2015-12-31 23:59:59') %>% 
  group_by(candy) %>% 
  summarise(ratings_sum = sum(ratings_numeric, na.rm = TRUE)) %>%
  mutate(max_rating = max(ratings_sum)) %>%
  filter(ratings_sum == max_rating) %>% 
  select(candy) %>% 
  pull()


```


8. What was the most popular candy bar by this rating for people in US, Canada, UK, and all other countries?

```{r}
most_popular_usa <- candy_cleaned %>% 
  filter(country == 'USA') %>% 
  group_by(candy) %>% 
  summarise(ratings_sum = sum(ratings_numeric, na.rm = TRUE)) %>%
  mutate(max_rating = max(ratings_sum)) %>%
  filter(ratings_sum == max_rating) %>% 
  select(candy) %>% 
  pull()

most_popular_canada <- candy_cleaned %>% 
  filter(country == 'CANADA') %>% 
  group_by(candy) %>% 
  summarise(ratings_sum = sum(ratings_numeric, na.rm = TRUE)) %>%
  mutate(max_rating = max(ratings_sum)) %>%
  filter(ratings_sum == max_rating) %>% 
  select(candy) %>% 
  pull()

most_popular_uk <- candy_cleaned %>% 
  filter(country == 'UK') %>% 
  group_by(candy) %>% 
  summarise(ratings_sum = sum(ratings_numeric, na.rm = TRUE)) %>%
  mutate(max_rating = max(ratings_sum)) %>%
  filter(ratings_sum == max_rating) %>% 
  select(candy) %>% 
  pull()

most_popular_rest_of_world <- candy_cleaned %>% 
  filter(country != 'USA' & country != 'CANADA' & country != 'UK') %>% 
  group_by(candy) %>% 
  summarise(ratings_sum = sum(ratings_numeric, na.rm = TRUE)) %>%
  mutate(max_rating = max(ratings_sum)) %>%
  filter(ratings_sum == max_rating) %>% 
  select(candy) %>% 
  pull()

most_popular_usa
most_popular_canada
most_popular_uk
most_popular_rest_of_world
```

